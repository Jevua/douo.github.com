---
title: 2015年12月11日杂记
date: '2015-12-11'
description:
type: draft ## 移除这个字段，笔记才会公开发布
---

### Http 协议层

#### OkHttp

OkHttp 是一个在 Socket 层面重新实现 Http 协议的 Http 客户端框架。作为 Android 默认 Http 框架的代替品，提供更好的兼容性支持，支持 Android 2.3 及以上。

1. 支持 HTTP/2 和 SPDY 允许发送到相同主机的请求共享同一个 socket
2. 合并多个连接来减少请求
3. 自动 GZIP 传输，减少网络数据的使用
4. 缓存机制，避免重复请求对网络资源的浪费

OkHttp 会从很多常用的连接问题中自动恢复。服务器配置了多个IP地址，当第一个IP连接失败的时候，OkHttp会自动尝试下一个IP。还能处理了代理服务器问题和SSL握手失败问题。

下图是 Http 协议层的结构图：


### Http 应用层

#### Vollley

Volley，是谷歌 2013 年推出的一个新的网络通信框架，致力于使网络通信更快，更简单，更健壮。Volley适合小而快的数据传输。被用于与进行数据交换的接口框架。

Volley 使用了线程池来作为基础结构，主要分为主线程，cache线程和network线程。主线程和cache线程都只有一个，而NetworkDispatcher线程可以有多个，这样能解决比并行问题。

下图是 Http 应用层的结构图：


下图是一次典型的后端接口调用的时序图：


#### Gson

Gson 是 Google 提供的用来在 Java 对象和 JSON 数据之间进行映射的 Java 类库。可以将一个 JSON 字符串转成一个 Java 对象，或者反过来。能极大的简单代码量，如下代码所示：

```
// 定义模板
class TplData{
  List<String> Genius_1;
  List<String> Genius_2;
}
 
// 解析  YourJsonString为传入的json格式的字符串
Gson gson = new Gson(); 
TplData data = gson.fromJson(YourJsonString, TplData.class);
 
// 获取数据
data.Genius_1.get(0);
data.Genius_2.get(0);
```


### 持久化

从软件的角度来说，程序运行过程中，通常都是把数据存放在变量，数组，字典等，也就是程序运行时候开辟的一块内存空间，但是随着程序的关闭，这块内存空间也跟着消失，数据也随即丢失。因此，我们需要把数据保存起来。这样就有了数据存储的动因。
从硬件的角度来讲，随着电路的断开，内存（RAM）上的数据也随即消失，只有硬盘上的数据能保存，因此，需要数据持久化。同时，内存空间往往也比硬盘空间小的多。

数据持久化，就是把数据保存起来，以便下次打开应用程序，还能获取这些数据，也称为数据存储等。


#### SQLite

Sqlite，是一款轻型的数据库，是遵守ACID的关系型数据库管理系统，它的设计目标是嵌入式的。

1. ACID事务
2. 零配置 – 无需安装和管理配置
3. 储存在单一磁盘文件中的一个完整的数据库
4. 数据库文件可以在不同字节顺序的机器间自由的共享
5. 支持数据库大小至2TB
6. 足够小, 大致13万行C代码, 4.43M
7. 比一些流行的数据库在大部分普通数据库操作要快
8. 简单, 轻松的API
9. 包含TCL绑定, 同时通过Wrapper支持其他语言的绑定
10. 良好注释的源代码, 并且有着90%以上的测试覆盖率
11. 独立: 没有额外依赖
12. 源码完全的开源, 你可以用于任何用途, 包括出售它
13. 支持多种开发语言，C, C++, PHP, Perl, Java, C#,Python, Ruby等

Android 系统，我们采用 Sqlite 来对应用数据进行持久化存储。

#### ORM 框架

ORM，对象关系映射（英语：Object Relational Mapping，简称ORM，或O/RM，或O/R mapping），是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换。从效果上说，它其实是创建了一个可在编程语言里使用的“虚拟对象数据库”。

greenDao，我们使用其作为我们的 orm 框架。greenDAO 是一个开源项目，它能映射 java 对象到数据表里，封装好存储，更新，删除等操作在 Java 接口上，从而避免了在代码中写 sql 的情况。能很好简化代码和提高开发效率。

