---
title: 2015年09月01日杂记
date: '2015-09-01'
description:
type: draft ## 移除这个字段，笔记才会公开发布
---

用列表或grid 来加载资源的时候，我们知道要用懒性加载。比如 ListAdapter 只有我们滑动到某个位置的时候，这个位置的视图才会被创建，比如列表加载图片，当图片视图到窗口时，我们创建显示这个视图，然后再去后台加载图片资源，这时用户可能滑动到别的位置了，后台是用队列来排队的，这时用户想要看到的图片资源是排在那些现在已在视窗之外的资源之后。
正确的实现是这些新来的资源，应该插在队列前面。
但是在用户滑动的过程中，队列内部的顺序也可能不断地发生变化。

比如我们要同时显示三张图片，这三张图片按先来后到的顺序加载有队列如下：

A <- B <- C

### 情况一

D 来了，那么 A 就离开屏，D 应该插在 C 后面。A 离屏优先级比当前屏幕的低，那么 D 插入后的顺序如下。

B <- C <- D <-A

然后 E 来了， B 离屏

C <- D <- E <- A <- B

用户又往回滑， E 离屏 ，B 来了

B <- C <- D <- A <- E

###　情况二

我们把离屏的直接删除，

D　来了，　A　离屏

B <- C <- D

E 来了， B 离屏

C <- D <- E

E 离屏 ，B 来了

C <- D <- B

情况是不是更简单了。



### 情况一实现

#### 优先队列


有几个基本行为

- 插入高优先级的对象
- 将集合内的对象降低优先级
- 提升集合内对象的优先级


一开始想到就是优先队列，基于堆的优先队列好像很合适。设置两个优先级，来代表的离屏和处于视窗中。而且相同优先级的对象也是 FIFO 的。

进队、入队：O(log(n))
peek：O(1)
查找、删除：O(n)

插入高优先级的对象，没有问题。

改动集合内对象的优先级就有问题，堆的构造是在插入时决定的。A 离屏降优先级，需要先将 A 删除，改优先级再插入，就不高效了。


#### 栈

后进先出的栈，

A <- B <- C 就变成 C <- B <- A 了，但 D 插进来的时候， D 的优先级最高，而 A 离屏，优先级最低，这是合适的。

提升集合内的优先级，再添加一次， A <- D <- C <- B <- A，也可满足要求，但可反复添加的元素可能会导致集合的 size 不可控

#### 循环队列

列表视图的操作决定了，循环队列是合适的。
